<!DOCTYPE html>
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="avalon.js"></script>

    </head>
    <body >


        <script>
            function expect(a) {
                return {
                    to: {
                        be: function (b) {
                            console.log(a, b, a === b)
                        }
                    }
                }
            }
            function heredoc(fn) {
                return fn.toString().replace(/^[^\/]+\/\*!?\s?/, '').replace(/\*\/[^\/]+$/, '')
            }
            avalon.config.async = false
            var vm = avalon.define({
                $id: "test",
                object: {
                    a: 1,
                    b: 1,
                    c: 1,
                    d: 1
                },
                text: "初始状态"
            })
            var body = document.body
            var div = document.createElement("div")
            div.innerHTML = heredoc(function () {
                /*
                <ul>
<!--                <li ms-repeat="object">{{$key}}:<strong>{{$val}}</strong></li>-->
                 </ul>
                 <ol ms-with="object">
                 <li>{{$key}}:<strong>{{$val}}</strong></li>
                 </ol>
                 */
            })
            body.appendChild(div)
            avalon.scan(div, vm)
            var prop = "innerText" in div ? "innerText" : "textContent"
//            setTimeout(function () {
//                vm.object = {
//                    x: 2,
//                    y: 2,
//                    z: 2,
//                    h: 2
//                }
//            }, 300)
//            setTimeout(function () {
//                vm.object = {
//                    a: 4,
//                    b: 2,
//                    c: 2,
//                    h: 3
//                }
//                setTimeout(function () {
//                    var lis = div.getElementsByTagName("li")
//                    expect(lis.length).to.be(8)
//                    expect(lis[0][prop]).to.be("a:4")
//                    expect(lis[1][prop]).to.be("b:2")
//                    expect(lis[2][prop]).to.be("c:2")
//                    expect(lis[3][prop]).to.be("h:3")
//                    expect(lis[4][prop]).to.be("a:4")
//                    expect(lis[5][prop]).to.be("b:2")
//                    expect(lis[6][prop]).to.be("c:2")
//                    expect(lis[7][prop]).to.be("h:3")
//                 //   clearTest(vm, div, done)
//                }, 200)
//            }, 600)
     
        </script>


    </body>

</html>