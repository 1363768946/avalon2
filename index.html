<!DOCTYPE html>
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="avalon.js"></script>

    </head>
    <body>
        <script>
            function expect(a) {
                return {
                    to: {
                        be: function (b) {
                            console.log(a, "|", b, a === b)
                        }
                    }
                }
            }
            function heredoc(fn) {
                return fn.toString().replace(/^[^\/]+\/\*!?\s?/, '').replace(/\*\/[^\/]+$/, '')
            }
            var vm = avalon.define({
                $id: "select-ms-duplex",
                k: "c",
                b: "b",
                array: ["a", "b", "c", "d"],
                selected: "c",
                callback: function (a, b, c) {
                    console.log("=========", a, b, c)
                }
            })
            var body = document.body
            var div = document.createElement("div")
            div.innerHTML = heredoc(function () {
                /*
                 <select id="sel1" ms-duplex="selected" ms-each="array">
                 <option >{{el}}</option>
                 </select>
                 <select id="sel2" ms-duplex="selected">
                 <option ms-repeat="array" data-repeat-rendered='callback'>{{el}}</option>
                 </select>
                 <select id="sel3" ms-duplex="selected">
                 <option value="a">a</option>
                 <option ms-attr-value="b">b</option>
                 <option ms-attr-text='k'></option>
                 <option>d</option>
                 </select>
                 <select id="sel4" ms-duplex="selected">
                 <option>a</option>
                 <option>c</option>
                 <option>b</option>
                 <option>d</option>
                 </select>
                 */
            })
            body.appendChild(div)
            avalon.scan(div, vm)
            setTimeout(function () {
                var ss = div.getElementsByTagName("select")
                expect(ss[0].options.length).to.be(4)
                expect(ss[1].options.length).to.be(4)

                expect(ss[0].options[2].selected).to.be(true)
                expect(ss[1].options[2].selected).to.be(true)
                expect(ss[2].options[2].selected).to.be(true)
                expect(ss[3].options[1].selected).to.be(true)
                
                setTimeout(function(){
                    vm.array = ["c","d","a"]
                },2000)
                // clearTest(vm, div, done)
            }, 300)
        </script>
        <div ms-controller="test">

        </div>
    </body>

</html>