<!DOCTYPE html>
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="avalon.js"></script>


    </head>
    <body>
        <div>TODO write content</div>
        <script>
            function expect(a) {
                return {
                    to: {
                        be: function (b) {
                            console.log(a, b, a === b)
                        }
                    }
                }
            }
            function fireClick(el) {
                if (el.click) {
                    el.click()
                } else {
//https://developer.mozilla.org/samples/domref/dispatchEvent.html
                    var evt = document.createEvent("MouseEvents")
                    evt.initMouseEvent("click", true, true, window,
                            0, 0, 0, 0, 0, false, false, false, false, 0, null);
                    !el.dispatchEvent(evt);
                }
            }
            function heredoc(fn) {
                return fn.toString().replace(/^[^\/]+\/\*!?\s?/, '').replace(/\*\/[^\/]+$/, '')
            }
            function clearTest(vmName, div, fn) {
                if (typeof vmName === "string") {
                    delete avalon.vmodels[vmName]
                } else if (vmName) {
                    delete avalon.vmodels[vmName.$id]
                }
                if (div) {
                    div.innerHTML = ""
                    document.body.removeChild(div)
                }
                if (fn) {
                    fn()
                }
            }
            var vm = avalon.define({
                $id: "test",
                array: [{
                        a: 1, b: "1111",
                    }, {
                        a: 2, b: "2222"
                    }, {
                        a: 3, b: "3333"
                    }],
                add: function () {
                    vm.array.push({
                        a: "4"
                    })
                },
                add2: function () {
                    console.log("xxxx")
                    vm.arr.push(new Date - 0)
                },
                setObject: function () {
                    vm.array.set(0, {a: 9})
                },
                arr: [1, 2, 3, 4],
                show: function () {
                    var rr = vm.array.map(function (el) {

                        return el.$events.a.$uuid
                    })
                    console.log(rr)
                }
            })//
            vm.array.forEach(function (el) {
                el.$watch("a", function (v) {
                    console.log(v)
                })
            })
            var body = document.body
            var div = document.createElement("div")
            div.innerHTML = heredoc(function () {
                /*
                 
                 <ul><li ms-repeat="array" >
                 <input type=radio ms-click=$remove>{{el.a}}<input ms-duplex="el.a"/></li>
                 </ul>
                 <button ms-click="add" type="button">add</button>
                 <button type=button ms-click=show>show</button>
                 <button type=button ms-click=setObject>setObject</button>
                 */
            })
            body.appendChild(div)
              avalon.scan(div, vm)



        </script>
        <h1>删除第一个元素后,再加一个,发现不同步了</h1>
      <div ms-controller="test">
            <ul>
                <li ms-repeat="arr"> <input type="radio" ms-click="$remove"/><input ms-duplex="el"/>{{el}}</li>
            </ul>
            <button type="button" ms-click="add2">add</button>
        </div>

    </body>
</html>
